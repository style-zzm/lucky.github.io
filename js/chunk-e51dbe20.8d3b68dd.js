(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e51dbe20"],{1664:function(t,e,a){},"4f10":function(t,e,a){"use strict";var i=a("b775"),o="/api/matter/forms",n={get:function(t){return i["a"].get(o+"/",t)},getFromByMatterId:function(t){return i["a"].get(o+"/form/".concat(t))}};e["a"]=n},"5d8c":function(t,e,a){"use strict";var i=a("d278"),o=a.n(i);o.a},"6e83":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"wrapper"}},[a("div",{staticClass:"content detail-form"},[t.formDataView.items&&t.formDataView.items.length>0?a("div",{ref:"formDataView",staticClass:"form-config-data-view"},[a("FormDataView",{attrs:{list:t.formDataView.items,"data-json":t.formDataOutJson,selectWg:t.selectWg,namePrefix:""},on:{"update:list":function(e){return t.$set(t.formDataView,"items",e)},"update:dataJson":function(e){t.formDataOutJson=e},"update:data-json":function(e){t.formDataOutJson=e}}})],1):t._e()]),a("div",{staticClass:"btn-group footer"},[this.$route.query.backto?t._e():a("mt-button",{staticClass:"mint-button mint-button--primary",attrs:{size:"large",type:"primary"},on:{click:t.saveForm}},[t._v("提交")])],1)])},o=[],n=a("cebc"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"temp-form-box "},t._l(t.list,function(e,i){return a("div",{key:i},["grid"===e.type||"tabs"===e.type||"table"===e.type||"title"===e.type?[t.controlWithLink(e)?a("div",["tabs"===e.type?a("div",t._l(e.tabs,function(i,o){return a("div",{key:o},[a("div",{staticClass:"table-row-data"},[a("div",{staticClass:"form-title"},[t._v(t._s(i.name_ch))]),a("FormDataView",{attrs:{list:i.items,"data-json":t.form[e.name][o],selectWg:t.selectWg,"name-prefix":""+t.namePrefix+e.name+"["+o+"]."},on:{"update:list":function(e){return t.$set(i,"items",e)},"update:dataJson":function(a){return t.$set(t.form[e.name],o,a)},"update:data-json":function(a){return t.$set(t.form[e.name],o,a)}}})],1)])}),0):t._e(),"grid"===e.type?a("div",t._l(e.columnSpans,function(e,i){return a("div",{key:i},[a("FormDataView",{attrs:{list:e.items,"data-json":t.form,selectWg:t.selectWg,"name-prefix":""+t.namePrefix},on:{"update:list":function(a){return t.$set(e,"items",a)},"update:dataJson":function(e){t.form=e},"update:data-json":function(e){t.form=e}}})],1)}),0):t._e(),"table"===e.type?[a("ul",{staticClass:"department-list",staticStyle:{margin:"0"}},t._l(t.form[e.name],function(i,o){return a("li",{key:o},[a("div",{staticClass:"name"},[t._v(t._s(i[e.headers[0].items[0].name])),e.headers.length>1?a("span",[t._v(t._s(i[e.headers[1].items[0].name]))]):t._e()]),a("div",{staticClass:"handle"},[a("mt-button",{on:{click:function(a){return t.handleEditRow(e,o)}}},[t._v("编辑")]),t.selectWg.config.editable?a("mt-button",{staticClass:"remove",attrs:{type:"danger",title:"删除"},on:{click:function(a){return a.stopPropagation(),t.handleDeleteRow(e,o)}}},[a("i",{staticClass:"iconfont icon-shanchu"})]):t._e()],1)])}),0),a("div",{staticClass:"input-row"},[t.selectWg.config.editable?a("button",{staticClass:"upload",attrs:{type:"button",title:"添加"},on:{click:function(a){return a.stopPropagation(),t.handleAddRow(e)}}},[t._v("添加")]):t._e()]),t.popupForm.item?a("mt-popup",{staticClass:"edit-popup-box",attrs:{closeOnClickModal:!1,position:"right","popup-transition":"popup-fade"},model:{value:t.popupForm.popupVisible,callback:function(e){t.$set(t.popupForm,"popupVisible",e)},expression:"popupForm.popupVisible"}},[a("div",{staticClass:"popup-container detail-form"},t._l(t.popupForm.item.headers,function(e,i){return a("div",{key:i},[t.popupForm.data?a("FormDataView",{attrs:{list:e.items,"data-json":t.popupForm.data,selectWg:t.selectWg,tableHeaderNameCh:e.name_ch,"name-prefix":""+t.namePrefix+t.popupForm.item.name+"["+t.popupForm.rowIndex+"]."},on:{"update:list":function(a){return t.$set(e,"items",a)},"update:dataJson":function(e){return t.$set(t.popupForm,"data",e)},"update:data-json":function(e){return t.$set(t.popupForm,"data",e)}}}):t._e()],1)}),0),a("div",{staticClass:"btn-group footer"},[a("mt-button",{staticClass:"mint-button mint-button--primary",attrs:{size:"large",type:"primary"},on:{click:function(e){t.popupForm.popupVisible=!1}}},[t._v("确定")])],1)]):t._e()]:t._e(),"title"===e.type?a("div",{staticClass:"form-title"},[a("i",{staticClass:"iconfont icon-neirong"}),t._v(t._s(e.name_ch))]):t._e()],2):t._e()]:[t.controlWithLink(e)?[a("FormItem",{staticClass:"temp-form-item",attrs:{item:e,model:t.form,editable:t.selectWg.config.editable,tableHeaderNameCh:t.tableHeaderNameCh}})]:t._e()]],2)}),0)},s=[],c=a("7618"),l=(a("7f7f"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["input"===t.item.type?a("mt-field",{attrs:{label:t.item.name_ch,placeholder:t.item.placeholder},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"radio"===t.item.type?a("mt-radio",{attrs:{title:t.item.name_ch,options:t.item.optionList},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"checkbox"===t.item.type?a("mt-checklist",{attrs:{title:t.item.name_ch,options:t.item.optionList},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"select"===t.item.type?["select"===t.item.type?a("mt-field",{attrs:{label:t.item.name_ch,"disable-clear":!0,readonly:!0,placeholder:t.item.placeholder},model:{value:t.nameTxt,callback:function(e){t.nameTxt=e},expression:"nameTxt"}},[a("i",{staticClass:"icomoon-search",on:{click:t.clickBtn}})]):t._e(),a("mt-popup",{staticClass:"popup-item",attrs:{"popup-transition":"popup-fade",position:"bottom"},model:{value:t.popupVisible,callback:function(e){t.popupVisible=e},expression:"popupVisible"}},[a("mt-picker",{attrs:{slots:t.getSelectOptions(),"value-key":"label"},on:{change:t.changePicker}})],1)]:t._e(),"number"===t.item.type||"rate"===t.item.type?a("mt-field",{attrs:{label:t.item.name_ch,placeholder:t.item.placeholder,type:"number"},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"textarea"===t.item.type?a("mt-field",{attrs:{label:t.item.name_ch,placeholder:t.item.placeholder},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"switch"===t.item.type?a("mt-cell",{attrs:{title:t.item.name_ch}},[a("mt-switch",{model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}})],1):t._e(),"slider"===t.item.type?a("mt-range",{model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}}):t._e(),"datePicker"===t.item.type||"timePicker"===t.item.type?a("mt-field",{attrs:{label:t.item.name_ch,readonly:!0,"disable-clear":!0,placeholder:t.item.placeholder},model:{value:t.form[t.item.name],callback:function(e){t.$set(t.form,t.item.name,e)},expression:"form[item.name]"}},[a("i",{staticClass:"icon-calendar",on:{click:t.openPicker}})]):t._e(),"datePicker"===t.item.type?a("mt-datetime-picker",{ref:"datetimePicker_"+t.item.name,attrs:{type:"date","year-format":"{value}","month-format":"{value}","date-format":"{value}","hour-format":"{value}","minute-format":"{value}"},on:{confirm:t.formatDate},model:{value:t.checkDate,callback:function(e){t.checkDate=e},expression:"checkDate"}}):t._e(),"timePicker"===t.item.type?a("mt-datetime-picker",{ref:"datetimePicker_"+t.item.name,attrs:{type:"time","hour-format":"{value}","minute-format":"{value}"},on:{confirm:t.formatDate},model:{value:t.checkTime,callback:function(e){t.checkTime=e},expression:"checkTime"}}):t._e()],2)}),m=[],u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"select-container"},["select"==t.inputType?a("el-select",{attrs:{disabled:t.disabled,clearable:""},model:{value:t.selectItem,callback:function(e){t.selectItem=e},expression:"selectItem"}},t._l(t.options,function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}),1):t._e(),"radio"==t.inputType?a("el-radio-group",{attrs:{disabled:t.disabled},model:{value:t.selectItem,callback:function(e){t.selectItem=e},expression:"selectItem"}},t._l(t.options,function(e){return a("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1):t._e(),"checkbox"==t.inputType?a("el-checkbox-group",{attrs:{disabled:t.disabled},model:{value:t.selectItem,callback:function(e){t.selectItem=e},expression:"selectItem"}},t._l(t.options,function(e){return a("el-checkbox",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1):t._e()],1)},p=[],f=a("9b31"),d={name:"Selection",props:{selectProp:{required:!0},dictType:{required:!0,type:String},parentId:{required:!1,type:String,default:"0"},selectVal:{required:!1,default:null},inputType:{required:!0,type:String,default:""},disabled:{required:!1,type:Boolean,default:!1}},data:function(){return{options:[],query:"",selectItem:this.selectProp?""+this.selectProp:null}},watch:{selectItem:function(){this.$emit("update:selectProp",this.selectItem)},selectProp:function(){this.selectItem=this.selectProp?""+this.selectProp:null}},created:function(){var t=this;f["a"].getList(this.dictType,this.parentId,"0").then(function(e){e.data&&0===e.data.code&&(t.options=e.data.data)}).catch(function(t){console.log(t)})},methods:{}},h=d,g=a("2877"),b=Object(g["a"])(h,u,p,!1,null,"70224e42",null),k=b.exports,y={name:"FormItem",components:{Selection:k},props:{item:{type:Object},model:{type:Object},editable:{type:Boolean},tableHeaderNameCh:{type:String}},data:function(){return{form:this.model||{},popupVisible:!1,nameTxt:"",checkDate:null,checkTime:""}},watch:{model:function(t,e){this.form=t||{},"select"===this.item.type&&this.getSelectOptionsVal(),"datePicker"===this.item.type&&(this.checkDate=this.form[this.item.name]?new Date(this.form[this.item.name]):null),"timePicker"===this.item.type&&(this.checkTime=this.form[this.item.name])},editable:function(t,e){this.item.options.isDisabled=!t}},created:function(){this.item.options.isDisabled=!this.editable,this.item.name_ch=this.tableHeaderNameCh||this.item.name_ch,this.item.placeholder=this.tableHeaderNameCh?"请输入"+this.tableHeaderNameCh:this.item.placeholder,"datePicker"===this.item.type&&(this.checkDate=this.form[this.item.name]?new Date(this.form[this.item.name]):null),"timePicker"===this.item.type&&(this.checkTime=this.form[this.item.name])},methods:{getSelectOptions:function(){return[{values:this.item.optionList,className:"slot1",textAlign:"center"}]},getSelectOptionsVal:function(){for(var t=this.item.optionList,e=0;e<t.length;e++)if(t[e].value===this.form[this.item.name]){this.nameTxt=t[e].name;break}},clickBtn:function(){this.popupVisible=!0},changePicker:function(t,e){this.nameTxt=e[0].label,this.form[this.item.name]=e.length&&e[0]?e[0].value:""},openPicker:function(){this.$refs["datetimePicker_".concat(this.item.name)].open()},formatDate:function(t){"timePicker"===this.item.type?this.form[this.item.name]=t:this.form[this.item.name]=t?t.format(this.item.options.formatPattern):""}}},v=y,_=(a("ab3a"),Object(g["a"])(v,l,m,!1,null,null,null)),x=_.exports,w={name:"FormDataView",components:{FormItem:x},props:{list:{required:!0,type:Array},dataJson:{required:!0,type:Object},selectWg:{type:Object},namePrefix:{type:String,defaultValue:""},tableHeaderNameCh:{type:String}},data:function(){return{form:this.dataJson,popupForm:{popupVisible:!1,item:null,rowIndex:null,data:{}}}},watch:{dataJson:function(t,e){this.form=t,this.initData()}},created:function(){this.initData()},methods:{handleDeleteRow:function(t,e){this.form[t.name].splice(e,1)},handleEditRow:function(t,e){this.popupForm.item=t,this.popupForm.popupVisible=!0,this.popupForm.data=this.form[t.name][e],this.popupForm.rowIndex=e},handleAddRow:function(t){for(var e={},a=0;a<t.headers.length;a++)for(var i=0;i<t.headers[a].items.length;i++){var o=t.headers[a].items[i],n=null;-1!==",number,rate,switch,slider,".indexOf(",".concat(o.type,","))?o.options.defaultValue&&(n=parseInt(o.options.defaultValue)):n=-1!==",checkbox,cascader,".indexOf(",".concat(o.type,","))?o.options.defaultValue?[o.options.defaultValue]:[]:o.options.defaultValue||"",e[o.name]=n}this.form[t.name].push(e)},initData:function(){for(var t=0;t<this.list.length;t++){var e=this.list[t];if(-1!==",input,textarea,number,timePicker,datePicker,rate,colorPicker,radio,checkbox,switch,slider,select,cascader,dictData,".indexOf(","+e.type+",")){if(this.form.hasOwnProperty(e.name))continue;var a=null;-1!==",number,rate,switch,slider,".indexOf(",".concat(e.type,","))?e.options.defaultValue&&(a=parseInt(e.options.defaultValue)):a=-1!==",checkbox,cascader,".indexOf(",".concat(e.type,","))?e.options.defaultValue?[e.options.defaultValue]:[]:e.options.defaultValue||"",this.$set(this.form,e.name,a)}else if("table"===e.type){if(this.form.hasOwnProperty(e.name))continue;this.$set(this.form,e.name,[])}else if("tabs"===e.type){if(this.form.hasOwnProperty(e.name))continue;for(var i=[],o=0;o<e.tabs.length;o++)i.push({});this.$set(this.form,e.name,i)}}},controlWithLink:function(t){if(!t.options.isControl)return!0;try{for(var e=this.selectWg.config.controlOptions,a=null,i=0;i<e.length;i++)if(t.options.linkedProperty===e[i].key){a=e[i].value;break}var o={propName:a,value:null};return this.getValWithPropName(this.selectWg.formData,o),!!a&&o.value+""===t.options.linkedPropertyValue}catch(n){console.error(n)}return!1},getValWithPropName:function(t,e){if(Array.isArray(t))for(var a=0;a<t.length;a++)this.getValWithPropName(t[a],e);else for(var i in t){if(i===e.propName){e.value=t[i];break}"object"===Object(c["a"])(t[i])&&this.getValWithPropName(t[i],e)}}}},I=w,D=Object(g["a"])(I,r,s,!1,null,"1921903a",null),P=D.exports,C=a("b775"),V="/api/sys/formConfig",O={list:function(t){return C["a"].get(V+"/",t)},get:function(t){return C["a"].get(V+"/"+t)},save:function(t){return C["a"].post(V+"/",t)},delete:function(t){return C["a"].delete(V+"/"+t)}},F=O,$=a("4f10"),W=a("82ec"),q="/api/task/taskWorkExecuteStorages",S={list:function(t){return C["a"].get(q+"/",t)},get:function(t){return C["a"].get(q+"/"+t)},save:function(t){return C["a"].post(q+"/",t)},delete:function(t){return C["a"].delete(q+"/"+t)}},T=S,j={name:"commonFormScene",components:{FormDataView:P},data:function(){return{formDataOutJson:{},formDataView:{},rules:{},form:{},selectWg:{config:{},formData:{}},formConfigId:"",relationid:"",matterInfo:{},query:{id:"",workid:"",taskid:"",taskUserExecuteId:""},storageInfo:{workid:"",taskid:"",taskUserExecuteId:"",storage:""}}},created:function(){this.query.workid=this.$route.query.workid,this.query.taskid=this.$route.query.taskid,this.query.taskUserExecuteId=this.$route.query.taskUserExecuteId,this.relationid=this.$route.query.relationid,this.query.workid&&(this.storageInfo=Object(n["a"])({},this.storageInfo,this.query),this.getStorageInfo())},methods:{goBack:function(){this.$router.go(-1)},getStorageInfo:function(){var t=this;T.list(this.query).then(function(e){var a=e.data.data.records||[],i=a.length>0?a[0]:t.storageInfo;t.storageInfo.storage=i.storage,t.storageInfo.id=i.id,t.form=JSON.parse(t.storageInfo.storage||"{}"),t.formDataOutJson=JSON.parse(t.storageInfo.storage||"{}"),t.selectWg.formData=t.formDataOutJson,t.getMatterInfo(t.query.workid,function(e){t.matterInfo=e}),t.getMatterForms(t.query.workid,function(e){t.formConfigId=e.jsontemplateId,t.initFormData()})})},getFormData:function(t,e){F.get(t).then(function(t){t.data&&0===t.data.code&&e&&e(t.data.data||{})})},getMatterForms:function(t,e){$["a"].getFromByMatterId(t).then(function(t){t.data&&0===t.data.code&&e&&e(t.data.data||{})})},getMatterInfo:function(t,e){W["a"].get(t).then(function(t){t.data&&0===t.data.code&&e&&e(t.data.data||{})})},initFormData:function(){var t=this;this.formConfigId?this.getFormData(this.formConfigId,function(e){if(e){var a={};if(!e.content||""===e.content.trim())return void Toast({message:"未配置表单",iconClass:"icon icon-fail"});a=JSON.parse(e.content||"{}"),t.selectWg.config=a.config||{labelWidth:100,labelPosition:"right",size:"small",controlOptions:[]},t.selectWg.config.controlOptions||(t.selectWg.config.controlOptions=[]),t.selectWg.config.editable=!0,t.formDataView=a}}):Toast({message:"未配置表单",iconClass:"icon icon-success"})},saveForm:function(){var t=this;this.storageInfo.storage=JSON.stringify(this.formDataOutJson||{}),T.save(this.storageInfo).then(function(e){Toast({message:"保存成功",iconClass:"icon icon-success"}),t.goBack()})}}},J=j,N=(a("5d8c"),Object(g["a"])(J,i,o,!1,null,null,null));e["default"]=N.exports},"82ec":function(t,e,a){"use strict";var i=a("b775"),o="/api/matter/configs",n={list:function(t){return i["a"].get(o+"/",t)},get:function(t){return i["a"].get(o+"/"+t)},save:function(t){return i["a"].post(o+"/",t)},delete:function(t){return i["a"].delete(o+"/"+t)}};e["a"]=n},ab3a:function(t,e,a){"use strict";var i=a("1664"),o=a.n(i);o.a},d278:function(t,e,a){}}]);